/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { AbstractControl, FormGroup, FormArray, FormControl } from '@angular/forms';
import { getKeyPath, isNullOrUndefined } from '../../utils';
/**
 * \@experimental
 */
export class FieldFormExtension {
    /**
     * @param {?} field
     * @return {?}
     */
    onPopulate(field) {
        if (field.key && field.type) {
            /** @type {?} */
            const paths = getKeyPath({ key: field.key });
            /** @type {?} */
            let rootForm = (/** @type {?} */ (field.parent.formControl));
            /** @type {?} */
            let rootModel = field.fieldGroup ? { [paths[0]]: field.model } : field.model;
            paths.forEach((path, index) => {
                // FormGroup/FormArray only allow string value for path
                /** @type {?} */
                const formPath = path.toString();
                // is last item
                if (index === paths.length - 1) {
                    this.addFormControl(rootForm, field, rootModel, formPath);
                }
                else {
                    if (!rootModel[path]) {
                        rootModel[path] = typeof path === 'string' ? {} : [];
                    }
                    this.addFormControl(rootForm, { key: formPath, fieldGroup: [], modelOptions: {}, templateOptions: {} }, rootModel, formPath);
                    rootForm = (/** @type {?} */ (rootForm.get(formPath)));
                    rootModel = rootModel[path];
                }
            });
        }
        if (field.fieldGroup && !field.formControl) {
            field.formControl = field.parent.formControl;
        }
    }
    /**
     * @private
     * @param {?} form
     * @param {?} field
     * @param {?} model
     * @param {?} path
     * @return {?}
     */
    addFormControl(form, field, model, path) {
        /** @type {?} */
        const abstractControlOptions = (/** @type {?} */ ({
            validators: field._validators,
            asyncValidators: field._asyncValidators,
            updateOn: field.modelOptions.updateOn,
        }));
        /** @type {?} */
        let control;
        if (field.formControl instanceof AbstractControl || form.get((/** @type {?} */ (path)))) {
            control = field.formControl || form.get((/** @type {?} */ (path)));
            if (!(isNullOrUndefined(control.value) && isNullOrUndefined(model[path]))
                && control.value !== model[path]
                && control instanceof FormControl) {
                control.patchValue(model[path]);
            }
            if (abstractControlOptions.validators || abstractControlOptions.asyncValidators) {
                if (abstractControlOptions.validators) {
                    control.setValidators(abstractControlOptions.validators);
                }
                if (abstractControlOptions.asyncValidators) {
                    control.setAsyncValidators(abstractControlOptions.asyncValidators);
                }
                control.updateValueAndValidity();
            }
        }
        else if (field._componentFactory && field._componentFactory.component && field._componentFactory.component.createControl) {
            /** @type {?} */
            const component = field._componentFactory.component;
            console.warn(`NgxFormly: '${component.name}::createControl' is deprecated since v5.0, use 'prePopulate' hook instead.`);
            control = component.createControl(model[path], field);
        }
        else if (field.fieldGroup && !field.fieldArray) {
            control = new FormGroup({}, abstractControlOptions);
        }
        else if (field.fieldArray) {
            control = new FormArray([], abstractControlOptions);
        }
        else {
            control = new FormControl(model[path], abstractControlOptions);
        }
        if (field.templateOptions.disabled) {
            control.disable();
        }
        // Replace decorated property with a getter that returns the observable.
        // https://github.com/angular-redux/store/blob/master/src/decorators/select.ts#L79-L85
        if (delete field.templateOptions.disabled) {
            Object.defineProperty(field.templateOptions, 'disabled', {
                get: () => !field.formControl.enabled,
                set: (value) => value ? field.formControl.disable() : field.formControl.enable(),
                enumerable: true,
                configurable: true,
            });
        }
        if (field) {
            field.formControl = control;
        }
        if (form instanceof FormArray) {
            if (form.at((/** @type {?} */ (path))) !== control) {
                form.setControl((/** @type {?} */ (path)), control);
            }
        }
        else {
            if (form.get((/** @type {?} */ (path))) !== control) {
                form.setControl((/** @type {?} */ (path)), control);
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllbGQtZm9ybS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuZ3gtZm9ybWx5L2NvcmUvIiwic291cmNlcyI6WyJsaWIvZXh0ZW5zaW9ucy9maWVsZC1mb3JtL2ZpZWxkLWZvcm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUVBLE9BQU8sRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQTBCLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUcsT0FBTyxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGFBQWEsQ0FBQzs7OztBQUc1RCxNQUFNLE9BQU8sa0JBQWtCOzs7OztJQUM3QixVQUFVLENBQUMsS0FBNkI7UUFDdEMsSUFBSSxLQUFLLENBQUMsR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUU7O2tCQUNyQixLQUFLLEdBQUcsVUFBVSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQzs7Z0JBQ3hDLFFBQVEsR0FBRyxtQkFBQSxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBYTs7Z0JBQUUsU0FBUyxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLO1lBQzlILEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUU7OztzQkFFdEIsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2hDLGVBQWU7Z0JBQ2YsSUFBSSxLQUFLLEtBQUssS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQzlCLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUM7aUJBQzNEO3FCQUFNO29CQUNMLElBQUksQ0FB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QyxtQkFBUyxJQUFJLEVBQUEsRUFBRSxPQUFPLENBQUMsQ0FBQzthQUN6QztTQUNGO2FBQU07WUFDTCxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsbUJBQVMsSUFBSSxFQUFBLENBQUMsS0FBSyxPQUFPLEVBQUU7Z0JBQ3ZDLElBQUksQ0FBQyxVQUFVLENBQUMsbUJBQVMsSUFBSSxFQUFBLEVBQUUsT0FBTyxDQUFDLENBQUM7YUFDekM7U0FDRjtJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1seUV4dGVuc2lvbiB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2Zvcm1seS5jb25maWcnO1xuaW1wb3J0IHsgRm9ybWx5RmllbGRDb25maWdDYWNoZSB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvZm9ybWx5LmZpZWxkLmNvbmZpZyc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIEZvcm1Hcm91cCwgRm9ybUFycmF5LCBGb3JtQ29udHJvbCwgQWJzdHJhY3RDb250cm9sT3B0aW9ucyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IGdldEtleVBhdGgsIGlzTnVsbE9yVW5kZWZpbmVkIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuXG4vKiogQGV4cGVyaW1lbnRhbCAqL1xuZXhwb3J0IGNsYXNzIEZpZWxkRm9ybUV4dGVuc2lvbiBpbXBsZW1lbnRzIEZvcm1seUV4dGVuc2lvbiB7XG4gIG9uUG9wdWxhdGUoZmllbGQ6IEZvcm1seUZpZWxkQ29uZmlnQ2FjaGUpIHtcbiAgICBpZiAoZmllbGQua2V5ICYmIGZpZWxkLnR5cGUpIHtcbiAgICAgIGNvbnN0IHBhdGhzID0gZ2V0S2V5UGF0aCh7IGtleTogZmllbGQua2V5IH0pO1xuICAgICAgbGV0IHJvb3RGb3JtID0gZmllbGQucGFyZW50LmZvcm1Db250cm9sIGFzIEZvcm1Hcm91cCwgcm9vdE1vZGVsID0gZmllbGQuZmllbGRHcm91cCA/IHsgW3BhdGhzWzBdXTogZmllbGQubW9kZWwgfSA6IGZpZWxkLm1vZGVsO1xuICAgICAgcGF0aHMuZm9yRWFjaCgocGF0aCwgaW5kZXgpID0+IHtcbiAgICAgICAgLy8gRm9ybUdyb3VwL0Zvcm1BcnJheSBvbmx5IGFsbG93IHN0cmluZyB2YWx1ZSBmb3IgcGF0aFxuICAgICAgICBjb25zdCBmb3JtUGF0aCA9IHBhdGgudG9TdHJpbmcoKTtcbiAgICAgICAgLy8gaXMgbGFzdCBpdGVtXG4gICAgICAgIGlmIChpbmRleCA9PT0gcGF0aHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgIHRoaXMuYWRkRm9ybUNvbnRyb2wocm9vdEZvcm0sIGZpZWxkLCByb290TW9kZWwsIGZvcm1QYXRoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIXJvb3RNb2RlbFtwYXRoXSkge1xuICAgICAgICAgICAgcm9vdE1vZGVsW3BhdGhdID0gdHlwZW9mIHBhdGggPT09ICdzdHJpbmcnID8ge30gOiBbXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5hZGRGb3JtQ29udHJvbChyb290Rm9ybSwgeyBrZXk6IGZvcm1QYXRoLCBmaWVsZEdyb3VwOiBbXSwgbW9kZWxPcHRpb25zOiB7fSwgdGVtcGxhdGVPcHRpb25zOiB7fSB9LCByb290TW9kZWwsIGZvcm1QYXRoKTtcblxuICAgICAgICAgIHJvb3RGb3JtID0gPEZvcm1Hcm91cD4gcm9vdEZvcm0uZ2V0KGZvcm1QYXRoKTtcbiAgICAgICAgICByb290TW9kZWwgPSByb290TW9kZWxbcGF0aF07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChmaWVsZC5maWVsZEdyb3VwICYmICFmaWVsZC5mb3JtQ29udHJvbCkge1xuICAgICAgZmllbGQuZm9ybUNvbnRyb2wgPSBmaWVsZC5wYXJlbnQuZm9ybUNvbnRyb2w7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhZGRGb3JtQ29udHJvbChmb3JtOiBGb3JtR3JvdXAgfCBGb3JtQXJyYXksIGZpZWxkOiBGb3JtbHlGaWVsZENvbmZpZ0NhY2hlLCBtb2RlbDogYW55LCBwYXRoOiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICBjb25zdCBhYnN0cmFjdENvbnRyb2xPcHRpb25zID0ge1xuICAgICAgdmFsaWRhdG9yczogZmllbGQuX3ZhbGlkYXRvcnMsXG4gICAgICBhc3luY1ZhbGlkYXRvcnM6IGZpZWxkLl9hc3luY1ZhbGlkYXRvcnMsXG4gICAgICB1cGRhdGVPbjogZmllbGQubW9kZWxPcHRpb25zLnVwZGF0ZU9uLFxuICAgIH0gYXMgQWJzdHJhY3RDb250cm9sT3B0aW9ucztcbiAgICBsZXQgY29udHJvbDogQWJzdHJhY3RDb250cm9sO1xuXG4gICAgaWYgKGZpZWxkLmZvcm1Db250cm9sIGluc3RhbmNlb2YgQWJzdHJhY3RDb250cm9sIHx8IGZvcm0uZ2V0KDxzdHJpbmc+IHBhdGgpKSB7XG4gICAgICBjb250cm9sID0gZmllbGQuZm9ybUNvbnRyb2wgfHwgZm9ybS5nZXQoPHN0cmluZz4gcGF0aCk7XG4gICAgICBpZiAoXG4gICAgICAgICEoaXNOdWxsT3JVbmRlZmluZWQoY29udHJvbC52YWx1ZSkgJiYgaXNOdWxsT3JVbmRlZmluZWQobW9kZWxbcGF0aF0pKVxuICAgICAgICAmJiBjb250cm9sLnZhbHVlICE9PSBtb2RlbFtwYXRoXVxuICAgICAgICAmJiBjb250cm9sIGluc3RhbmNlb2YgRm9ybUNvbnRyb2xcbiAgICAgICkge1xuICAgICAgICBjb250cm9sLnBhdGNoVmFsdWUobW9kZWxbcGF0aF0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoYWJzdHJhY3RDb250cm9sT3B0aW9ucy52YWxpZGF0b3JzIHx8IGFic3RyYWN0Q29udHJvbE9wdGlvbnMuYXN5bmNWYWxpZGF0b3JzKSB7XG4gICAgICAgIGlmIChhYnN0cmFjdENvbnRyb2xPcHRpb25zLnZhbGlkYXRvcnMpIHtcbiAgICAgICAgICBjb250cm9sLnNldFZhbGlkYXRvcnMoYWJzdHJhY3RDb250cm9sT3B0aW9ucy52YWxpZGF0b3JzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWJzdHJhY3RDb250cm9sT3B0aW9ucy5hc3luY1ZhbGlkYXRvcnMpIHtcbiAgICAgICAgICBjb250cm9sLnNldEFzeW5jVmFsaWRhdG9ycyhhYnN0cmFjdENvbnRyb2xPcHRpb25zLmFzeW5jVmFsaWRhdG9ycyk7XG4gICAgICAgIH1cbiAgICAgICAgY29udHJvbC51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChmaWVsZC5fY29tcG9uZW50RmFjdG9yeSAmJiBmaWVsZC5fY29tcG9uZW50RmFjdG9yeS5jb21wb25lbnQgJiYgZmllbGQuX2NvbXBvbmVudEZhY3RvcnkuY29tcG9uZW50LmNyZWF0ZUNvbnRyb2wpIHtcbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGZpZWxkLl9jb21wb25lbnRGYWN0b3J5LmNvbXBvbmVudDtcbiAgICAgIGNvbnNvbGUud2FybihgTmd4Rm9ybWx5OiAnJHtjb21wb25lbnQubmFtZX06OmNyZWF0ZUNvbnRyb2wnIGlzIGRlcHJlY2F0ZWQgc2luY2UgdjUuMCwgdXNlICdwcmVQb3B1bGF0ZScgaG9vayBpbnN0ZWFkLmApO1xuICAgICAgY29udHJvbCA9IGNvbXBvbmVudC5jcmVhdGVDb250cm9sKG1vZGVsW3BhdGhdLCBmaWVsZCk7XG4gICAgfSBlbHNlIGlmIChmaWVsZC5maWVsZEdyb3VwICYmICFmaWVsZC5maWVsZEFycmF5KSB7XG4gICAgICBjb250cm9sID0gbmV3IEZvcm1Hcm91cCh7fSwgYWJzdHJhY3RDb250cm9sT3B0aW9ucyk7XG4gICAgfSBlbHNlIGlmIChmaWVsZC5maWVsZEFycmF5KSB7XG4gICAgICBjb250cm9sID0gbmV3IEZvcm1BcnJheShbXSwgYWJzdHJhY3RDb250cm9sT3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2wobW9kZWxbcGF0aF0sIGFic3RyYWN0Q29udHJvbE9wdGlvbnMpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZC50ZW1wbGF0ZU9wdGlvbnMuZGlzYWJsZWQpIHtcbiAgICAgIGNvbnRyb2wuZGlzYWJsZSgpO1xuICAgIH1cblxuICAgIC8vIFJlcGxhY2UgZGVjb3JhdGVkIHByb3BlcnR5IHdpdGggYSBnZXR0ZXIgdGhhdCByZXR1cm5zIHRoZSBvYnNlcnZhYmxlLlxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyLXJlZHV4L3N0b3JlL2Jsb2IvbWFzdGVyL3NyYy9kZWNvcmF0b3JzL3NlbGVjdC50cyNMNzktTDg1XG4gICAgaWYgKGRlbGV0ZSBmaWVsZC50ZW1wbGF0ZU9wdGlvbnMuZGlzYWJsZWQpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShmaWVsZC50ZW1wbGF0ZU9wdGlvbnMsICdkaXNhYmxlZCcsIHtcbiAgICAgICAgZ2V0OiAoKSA9PiAhZmllbGQuZm9ybUNvbnRyb2wuZW5hYmxlZCxcbiAgICAgICAgc2V0OiAodmFsdWU6IGJvb2xlYW4pID0+IHZhbHVlID8gZmllbGQuZm9ybUNvbnRyb2wuZGlzYWJsZSgpIDogZmllbGQuZm9ybUNvbnRyb2wuZW5hYmxlKCksXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChmaWVsZCkge1xuICAgICAgZmllbGQuZm9ybUNvbnRyb2wgPSBjb250cm9sO1xuICAgIH1cblxuICAgIGlmIChmb3JtIGluc3RhbmNlb2YgRm9ybUFycmF5KSB7XG4gICAgICBpZiAoZm9ybS5hdCg8bnVtYmVyPiBwYXRoKSAhPT0gY29udHJvbCkge1xuICAgICAgICBmb3JtLnNldENvbnRyb2woPG51bWJlcj4gcGF0aCwgY29udHJvbCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChmb3JtLmdldCg8c3RyaW5nPiBwYXRoKSAhPT0gY29udHJvbCkge1xuICAgICAgICBmb3JtLnNldENvbnRyb2woPHN0cmluZz4gcGF0aCwgY29udHJvbCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=